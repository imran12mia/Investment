<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f6; margin: 0; display: flex; }
        .sidebar { width: 250px; background-color: #2c3e50; color: white; height: 100vh; position: fixed; overflow-y: auto; }
        .sidebar h2 { text-align: center; padding: 20px 0; border-bottom: 1px solid #34495e; margin: 0; }
        .sidebar ul { list-style: none; padding: 0; margin: 0; }
        .sidebar ul li { padding: 15px 25px; cursor: pointer; border-bottom: 1px solid #34495e; transition: 0.3s; }
        .sidebar ul li:hover, .sidebar ul li.active { background-color: #3498db; }
        .main-content { margin-left: 250px; flex-grow: 1; padding: 30px; }
        .page-section { display: none; }
        .page-section.active { display: block; }
        .data-table { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); overflow-x: auto; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f8f9fa; }
        .btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; color: white; margin: 2px; }
        .btn-approve { background-color: #28a745; }
        .btn-reject { background-color: #dc3545; }
        .btn-blue { background-color: #007bff; }
        input, textarea { width: 100%; padding: 10px; margin: 5px 0 15px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h2>
        <ul>
            <li class="nav-btn active" onclick="showSection('dashboard')">‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</li>
            <li class="nav-btn" onclick="showSection('deposits')">‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü</li>
            <li class="nav-btn" onclick="showSection('withdraws')">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü</li>
            <li class="nav-btn" onclick="showSection('users')">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü & ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶∏</li>
            <li class="nav-btn" onclick="showSection('settings')">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</li>
        </ul>
    </div>

    <div class="main-content">
        <div id="dashboard" class="page-section active">
            <h1>‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h1>
            <div class="data-table">
                <p>‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏: <strong id="firebase-status" style="color:orange">‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</strong></p>
            </div>
        </div>

        <div id="deposits" class="page-section">
            <h1>üü° ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</h1>
            <div class="data-table">
                <table><thead><tr><th>‡¶á‡¶â‡¶ú‡¶æ‡¶∞</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ + ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</th><th>‡¶Æ‡ßá‡¶•‡¶° & TrxID</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr></thead><tbody id="deposit-list"></tbody></table>
            </div>
        </div>

        <div id="withdraws" class="page-section">
            <h1>‚è≥ ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</h1>
            <div class="data-table">
                <table><thead><tr><th>‡¶á‡¶â‡¶ú‡¶æ‡¶∞</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr></thead><tbody id="withdraw-list"></tbody></table>
            </div>
        </div>

        <div id="users" class="page-section">
            <h1>üë• ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h1>
            <div class="data-table">
                <button class="btn btn-blue" onclick="loadUserStats()">üîÑ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂</button>
                <input type="text" id="search-box" onkeyup="filterUsers()" placeholder="‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö..." style="margin-top:10px;">
                <table>
                    <thead><tr><th>‡¶®‡¶æ‡¶Æ & ‡¶Ü‡¶á‡¶°‡¶ø</th><th>‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</th><th>‡¶∞‡ßá‡¶´‡¶æ‡¶∞</th><th>‡¶Æ‡ßã‡¶ü ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</th><th>‡¶Æ‡ßã‡¶ü ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</th><th>‡¶è‡¶°‡¶ø‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</th></tr></thead>
                    <tbody id="user-stats-body"><tr><td colspan="6">‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</td></tr></tbody>
                </table>
            </div>
        </div>

        <div id="settings" class="page-section">
            <h1>‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h1>
            <div class="data-table">
                <h3>‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶ì ‡¶®‡¶ø‡ßü‡¶Æ</h3>
                <label>‡¶®‡ßã‡¶ü‡¶ø‡¶∂:</label> <textarea id="notice-input"></textarea>
                <button class="btn btn-blue" onclick="saveNotice()">‡¶∏‡ßá‡¶≠</button>
                <br><br>
                <label>‡¶®‡¶ø‡ßü‡¶Æ:</label> <textarea id="rules-input"></textarea>
                <button class="btn btn-blue" onclick="saveRules()">‡¶∏‡ßá‡¶≠</button>
            </div>
            <div class="data-table">
                <h3>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</h3>
                <label>‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂:</label> <input type="text" id="bkash-num">
                <label>‡¶®‡¶ó‡¶¶:</label> <input type="text" id="nagad-num">
                <button class="btn btn-blue" onclick="saveNumbers()">‡¶∏‡ßá‡¶≠</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyCF9cqEoQwPow2VbB0Koj1yyy4QMDofPQE",
          authDomain: "investmentwebsite1.firebaseapp.com",
          databaseURL: "https://investmentwebsite1-default-rtdb.firebaseio.com", 
          projectId: "investmentwebsite1",
          storageBucket: "investmentwebsite1.firebasestorage.app",
          messagingSenderId: "592540774650",
          appId: "1:592540774650:web:1ad31bf96cbc8c60db1943",
          measurementId: "G-QLTC23GYRE"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        db.ref(".info/connected").on("value", s => {
            document.getElementById('firebase-status').innerText = s.val() ? "‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‚úÖ" : "‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‚ùå";
            document.getElementById('firebase-status').style.color = s.val() ? "green" : "red";
        });

        function showSection(id) {
            document.querySelectorAll('.page-section').forEach(d => d.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'users') loadUserStats();
        }

        // ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶ø‡¶Ç
        db.ref('deposits').orderByChild('status').equalTo('pending').on('value', s => {
            const el = document.getElementById('deposit-list'); el.innerHTML = '';
            if(!s.exists()) { el.innerHTML = '<tr><td colspan="4">‡¶®‡ßá‡¶á</td></tr>'; return; }
            s.forEach(d => {
                const v = d.val();
                el.innerHTML += `<tr>
                    <td>${v.userName}<br><small>${v.userId}</small></td>
                    <td>‡ß≥${v.amount} + ${v.bonus}</td>
                    <td>${v.method}<br><small>${v.trxId}</small></td>
                    <td><button class="btn btn-approve" onclick="approveDep('${d.key}')">‚úî</button> <button class="btn btn-reject" onclick="rejectDep('${d.key}')">‚úñ</button></td>
                </tr>`;
            });
        });

        db.ref('withdrawals').orderByChild('status').equalTo('pending').on('value', s => {
            const el = document.getElementById('withdraw-list'); el.innerHTML = '';
            if(!s.exists()) { el.innerHTML = '<tr><td colspan="4">‡¶®‡ßá‡¶á</td></tr>'; return; }
            s.forEach(d => {
                const v = d.val();
                el.innerHTML += `<tr>
                    <td>${v.userName}<br><small>${v.userId}</small></td>
                    <td>‡ß≥${v.amount}</td>
                    <td>${v.number} (${v.method})</td>
                    <td><button class="btn btn-approve" onclick="approveWid('${d.key}')">‚úî</button> <button class="btn btn-reject" onclick="rejectWid('${d.key}')">‚úñ</button></td>
                </tr>`;
            });
        });

        function approveDep(k) {
            if(!confirm("‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")) return;
            db.ref('deposits/'+k).get().then(s => {
                const d = s.val();
                db.ref('users/'+d.userId+'/balance').transaction(c => (c||0) + d.amount + d.bonus)
                .then(() => db.ref('deposits/'+k).update({status:'approved'}));
            });
        }
        function rejectDep(k) { if(confirm("‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")) db.ref('deposits/'+k).update({status:'rejected'}); }

        function approveWid(k) { if(confirm("‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßá‡¶®?")) db.ref('withdrawals/'+k).update({status:'approved'}); }
        function rejectWid(k) {
            if(!confirm("‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")) return;
            db.ref('withdrawals/'+k).get().then(s => {
                db.ref('users/'+s.val().userId+'/balance').transaction(c => (c||0) + s.val().amount)
                .then(() => db.ref('withdrawals/'+k).update({status:'rejected'}));
            });
        }

        // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶∏
        async function loadUserStats() {
            const tbody = document.getElementById('user-stats-body');
            tbody.innerHTML = '<tr><td colspan="6">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>';
            const [users, deps, wids] = await Promise.all([db.ref('users').get(), db.ref('deposits').get(), db.ref('withdrawals').get()]);
            
            if(!users.exists()) { tbody.innerHTML = '<tr><td colspan="6">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</td></tr>'; return; }

            let data = {};
            users.forEach(u => data[u.key] = { ...u.val(), key: u.key, refs: 0, tDep: 0, tWid: 0 });

            Object.values(data).forEach(u => { if(u.referredBy && data[u.referredBy]) data[u.referredBy].refs++; });

            if(deps.exists()) deps.forEach(d => { if(d.val().status === 'approved' && data[d.val().userId]) data[d.val().userId].tDep += (d.val().amount + d.val().bonus); });
            if(wids.exists()) wids.forEach(w => { if(w.val().status === 'approved' && data[w.val().userId]) data[w.val().userId].tWid += w.val().amount; });

            tbody.innerHTML = '';
            Object.values(data).reverse().forEach(u => {
                tbody.innerHTML += `<tr>
                    <td>${u.name}<br><small>${u.key}</small></td>
                    <td style="color:blue;font-weight:bold">‡ß≥${u.balance}</td>
                    <td>${u.refs}</td>
                    <td style="color:green">‡ß≥${u.tDep}</td>
                    <td style="color:red">‡ß≥${u.tWid}</td>
                    <td><input type="number" id="b-${u.key}" style="width:80px;margin:0" placeholder="New"> <button class="btn btn-blue" onclick="setBal('${u.key}')">Set</button></td>
                </tr>`;
            });
        }

        function setBal(uid) {
            const val = parseFloat(document.getElementById('b-'+uid).value);
            if(!isNaN(val) && confirm('‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?')) db.ref('users/'+uid).update({balance:val}).then(()=>{alert('‡¶π‡ßü‡ßá‡¶õ‡ßá'); loadUserStats();});
        }
        function filterUsers() {
            const filter = document.getElementById('search-box').value.toUpperCase();
            const tr = document.getElementById('user-stats-body').getElementsByTagName('tr');
            for(let i=0; i<tr.length; i++) {
                const td = tr[i].getElementsByTagName('td')[0];
                if(td) tr[i].style.display = td.textContent.toUpperCase().indexOf(filter) > -1 ? "" : "none";
            }
        }

        // ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
        function saveNotice() { db.ref('settings/notice').set({text: document.getElementById('notice-input').value}).then(()=>alert('Saved')); }
        function saveRules() { db.ref('settings/rules').set({text: document.getElementById('rules-input').value}).then(()=>alert('Saved')); }
        function saveNumbers() { db.ref('settings/paymentNumbers').set({bkash: document.getElementById('bkash-num').value, nagad: document.getElementById('nagad-num').value}).then(()=>alert('Saved')); }

        // ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶≤‡ßã‡¶°
        db.ref('settings').get().then(s => {
            if(s.exists()) {
                if(s.val().notice) document.getElementById('notice-input').value = s.val().notice.text;
                if(s.val().rules) document.getElementById('rules-input').value = s.val().rules.text;
                if(s.val().paymentNumbers) {
                    document.getElementById('bkash-num').value = s.val().paymentNumbers.bkash;
                    document.getElementById('nagad-num').value = s.val().paymentNumbers.nagad;
                }
            }
        });
    </script>
</body>
</html>
