<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ - ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç ‡¶™‡ßç‡¶∞‡ßã</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f6; margin: 0; display: flex; }
        .sidebar { width: 250px; background-color: #2c3e50; color: white; height: 100vh; position: fixed; overflow-y: auto; }
        .sidebar h2 { text-align: center; padding: 20px 0; border-bottom: 1px solid #34495e; margin: 0; }
        .sidebar ul { list-style: none; padding: 0; margin: 0; }
        .sidebar ul li { padding: 15px 25px; cursor: pointer; border-bottom: 1px solid #34495e; transition: 0.3s; }
        .sidebar ul li:hover, .sidebar ul li.active { background-color: #3498db; }
        .main-content { margin-left: 250px; flex-grow: 1; padding: 30px; }
        .page-section { display: none; }
        .page-section.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .data-table { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); overflow-x: auto; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f8f9fa; font-weight: 600; color: #444; }
        
        .btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; color: white; margin: 2px; font-size: 0.9em; }
        .btn-approve { background-color: #28a745; }
        .btn-reject { background-color: #dc3545; }
        .btn-blue { background-color: #007bff; }
        
        input, textarea { width: 100%; padding: 10px; margin: 5px 0 15px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        
        /* ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶ì ‡¶Ü‡¶á‡¶™‡¶ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ú ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
        .loc-badge { font-weight: bold; color: #d35400; font-size: 0.9em; display: block; margin-bottom: 4px; }
        .ip-badge { background-color: #e8f6f3; color: #16a085; padding: 3px 6px; border: 1px solid #16a085; border-radius: 4px; font-family: monospace; font-size: 0.85em; }
        .edit-box { display: flex; gap: 5px; }
        .edit-box input { width: 80px; margin: 0; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h2>
        <ul>
            <li class="nav-btn active" onclick="showSection('dashboard')">‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</li>
            <li class="nav-btn" onclick="showSection('users')">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ & ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®</li> <li class="nav-btn" onclick="showSection('deposits')">‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</li>
            <li class="nav-btn" onclick="showSection('withdraws')">‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</li>
            <li class="nav-btn" onclick="showSection('history')">‡¶∏‡¶ï‡¶≤ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</li>
            <li class="nav-btn" onclick="showSection('settings')">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</li>
        </ul>
    </div>

    <div class="main-content">

        <div id="dashboard" class="page-section active">
            <h1>‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h1>
            <div class="data-table">
                <h3>‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</h3>
                <p>‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶®: <strong id="firebase-status" style="color:orange">‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</strong></p>
            </div>
        </div>

        <div id="users" class="page-section">
            <h1>üë• ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® & ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç</h1>
            <div class="data-table">
                <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                    <button class="btn btn-blue" onclick="loadAllUserStats()">üîÑ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶°‡¶æ‡¶ü‡¶æ</button>
                    <input type="text" id="search-box" onkeyup="filterUsers()" placeholder="‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." style="width:250px; margin:0;">
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>‡¶®‡¶æ‡¶Æ & ‡¶Ü‡¶á‡¶°‡¶ø</th>
                            <th>‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® & VIP IP</th> <th>‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</th>
                            <th>‡¶Æ‡ßã‡¶ü ‡¶ú‡¶Æ‡¶æ/‡¶§‡ßã‡¶≤‡¶æ</th>
                            <th>‡¶è‡¶ï‡¶∂‡¶®</th>
                        </tr>
                    </thead>
                    <tbody id="user-table-body">
                        <tr><td colspan="5">‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="deposits" class="page-section">
            <h1>üü° ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</h1>
            <div class="data-table">
                <table><thead><tr><th>‡¶á‡¶â‡¶ú‡¶æ‡¶∞</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶Æ‡ßá‡¶•‡¶°</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr></thead><tbody id="deposit-list"></tbody></table>
            </div>
        </div>

        <div id="withdraws" class="page-section">
            <h1>‚è≥ ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</h1>
            <div class="data-table">
                <table><thead><tr><th>‡¶á‡¶â‡¶ú‡¶æ‡¶∞</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr></thead><tbody id="withdraw-list"></tbody></table>
            </div>
        </div>

        <div id="history" class="page-section">
            <h1>üìú ‡¶∏‡¶´‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</h1>
            <div class="data-table">
                <button class="btn btn-blue" onclick="loadAllHistory()">üîÑ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂</button>
                <br><br>
                <table><thead><tr><th>‡¶á‡¶â‡¶ú‡¶æ‡¶∞</th><th>‡¶ß‡¶∞‡¶®</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th></tr></thead><tbody id="history-list"></tbody></table>
            </div>
        </div>

        <div id="settings" class="page-section">
            <h1>‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h1>
            <div class="data-table">
                <label>‡¶®‡ßã‡¶ü‡¶ø‡¶∂:</label> <input id="notice-input"> <button class="btn btn-blue" onclick="saveNotice()">Save</button>
                <br><br>
                <label>‡¶®‡¶ø‡ßü‡¶Æ:</label> <textarea id="rules-input"></textarea> <button class="btn btn-blue" onclick="saveRules()">Save</button>
                <br><br>
                <label>‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂:</label><input id="bkash-num"> <label>‡¶®‡¶ó‡¶¶:</label><input id="nagad-num"> <button class="btn btn-blue" onclick="saveNumbers()">Save</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyCF9cqEoQwPow2VbB0Koj1yyy4QMDofPQE",
          authDomain: "investmentwebsite1.firebaseapp.com",
          databaseURL: "https://investmentwebsite1-default-rtdb.firebaseio.com", 
          projectId: "investmentwebsite1",
          storageBucket: "investmentwebsite1.firebasestorage.app",
          messagingSenderId: "592540774650",
          appId: "1:592540774650:web:1ad31bf96cbc8c60db1943",
          measurementId: "G-QLTC23GYRE"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        db.ref(".info/connected").on("value", s => {
            document.getElementById('firebase-status').innerText = s.val() ? "‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‚úÖ" : "‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‚ùå";
            document.getElementById('firebase-status').style.color = s.val() ? "green" : "red";
        });

        function showSection(id) {
            document.querySelectorAll('.page-section').forEach(d => d.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'users') loadAllUserStats();
            if(id === 'history') loadAllHistory();
        }

        // ==== ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç ‡¶∏‡¶π ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ====
        async function loadAllUserStats() {
            const tbody = document.getElementById('user-table-body');
            tbody.innerHTML = '<tr><td colspan="5">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>';
            
            try {
                const [users, deps, wids] = await Promise.all([db.ref('users').get(), db.ref('deposits').get(), db.ref('withdrawals').get()]);
                if(!users.exists()) { tbody.innerHTML = '<tr><td colspan="5">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</td></tr>'; return; }

                let data = {};
                users.forEach(u => {
                    data[u.key] = { 
                        ...u.val(), 
                        key: u.key, 
                        tDep: 0, tWid: 0,
                        ip: u.val().ip || 'N/A', // ‡¶Ü‡¶á‡¶™‡¶ø
                        location: u.val().location || 'Unknown Location' // ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®
                    };
                });

                if(deps.exists()) deps.forEach(d => { if(d.val().status==='approved' && data[d.val().userId]) data[d.val().userId].tDep += (d.val().amount+d.val().bonus); });
                if(wids.exists()) wids.forEach(w => { if(w.val().status==='approved' && data[w.val().userId]) data[w.val().userId].tWid += w.val().amount; });

                tbody.innerHTML = '';
                Object.values(data).reverse().forEach(u => {
                    tbody.innerHTML += `<tr>
                        <td><b>${u.name}</b><br><small>${u.key}</small></td>
                        <td>
                            <span class="loc-badge">üìç ${u.location}</span>
                            <span class="ip-badge">VIP IP: ${u.ip}</span>
                        </td>
                        <td style="color:blue; font-weight:bold">‡ß≥${u.balance}</td>
                        <td><span style="color:green">In: ${u.tDep}</span> | <span style="color:red">Out: ${u.tWid}</span></td>
                        <td>
                            <div class="edit-box">
                                <input type="number" id="b-${u.key}" placeholder="New">
                                <button class="btn btn-blue" onclick="setBal('${u.key}')">Set</button>
                            </div>
                        </td>
                    </tr>`;
                });
            } catch(e) { console.error(e); }
        }

        function setBal(uid) {
            const val = parseFloat(document.getElementById('b-'+uid).value);
            if(!isNaN(val) && confirm('‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?')) {
                db.ref('users/'+uid).update({balance: val}).then(() => {
                    alert('‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                    loadAllUserStats();
                });
            }
        }

        function filterUsers() {
            const filter = document.getElementById('search-box').value.toUpperCase();
            const tr = document.getElementById('user-table-body').getElementsByTagName('tr');
            for(let i=0; i<tr.length; i++) {
                const td = tr[i].getElementsByTagName('td')[0];
                if(td) tr[i].style.display = td.textContent.toUpperCase().indexOf(filter) > -1 ? "" : "none";
            }
        }

        // ==== ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶ø‡¶Ç ====
        db.ref('deposits').orderByChild('status').equalTo('pending').on('value', s => {
            const l = document.getElementById('deposit-list'); l.innerHTML = '';
            if(!s.exists()) l.innerHTML = '<tr><td colspan="4">‡¶®‡ßá‡¶á</td></tr>';
            s.forEach(d => {
                l.innerHTML += `<tr><td>${d.val().userName}</td><td>${d.val().amount}</td><td>${d.val().method}<br><small>${d.val().trxId}</small></td>
                <td><button class="btn btn-approve" onclick="doDep('${d.key}',true,${d.val().amount+d.val().bonus},'${d.val().userId}')">‚úî</button>
                <button class="btn btn-reject" onclick="doDep('${d.key}',false)">‚úñ</button></td></tr>`;
            });
        });
        db.ref('withdrawals').orderByChild('status').equalTo('pending').on('value', s => {
            const l = document.getElementById('withdraw-list'); l.innerHTML = '';
            if(!s.exists()) l.innerHTML = '<tr><td colspan="4">‡¶®‡ßá‡¶á</td></tr>';
            s.forEach(d => {
                l.innerHTML += `<tr><td>${d.val().userName}</td><td>${d.val().amount}</td><td>${d.val().number}</td>
                <td><button class="btn btn-approve" onclick="doWid('${d.key}',true)">‚úî</button>
                <button class="btn btn-reject" onclick="doWid('${d.key}',false,${d.val().amount},'${d.val().userId}')">‚úñ</button></td></tr>`;
            });
        });

        function doDep(k, app, amt, uid) {
            if(!confirm('Confirm action?')) return;
            if(app) db.ref('users/'+uid+'/balance').transaction(c=>(c||0)+amt).then(()=>db.ref('deposits/'+k).update({status:'approved'}));
            else db.ref('deposits/'+k).update({status:'rejected'});
        }
        function doWid(k, app, amt, uid) {
            if(!confirm('Confirm action?')) return;
            if(!app) db.ref('users/'+uid+'/balance').transaction(c=>(c||0)+amt).then(()=>db.ref('withdrawals/'+k).update({status:'rejected'}));
            else db.ref('withdrawals/'+k).update({status:'approved'});
        }

        async function loadAllHistory() {
            const l = document.getElementById('history-list'); l.innerHTML = '<tr><td colspan="4">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>';
            const [d, w] = await Promise.all([db.ref('deposits').get(), db.ref('withdrawals').get()]);
            let all = [];
            if(d.exists()) d.forEach(x => { if(x.val().status==='approved') all.push({...x.val(), t:'Deposit'}); });
            if(w.exists()) w.forEach(x => { if(x.val().status==='approved') all.push({...x.val(), t:'Withdraw'}); });
            
            l.innerHTML = '';
            all.reverse().forEach(x => {
                l.innerHTML += `<tr><td>${x.userName}</td><td>${x.t}</td><td>${x.amount}</td><td style="color:green">Approved</td></tr>`;
            });
        }

        // ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
        function saveNotice(){ db.ref('settings/notice').set({text:document.getElementById('notice-input').value}).then(()=>alert('Saved')); }
        function saveRules(){ db.ref('settings/rules').set({text:document.getElementById('rules-input').value}).then(()=>alert('Saved')); }
        function saveNumbers(){ db.ref('settings/paymentNumbers').set({bkash:document.getElementById('bkash-num').value, nagad:document.getElementById('nagad-num').value}).then(()=>alert('Saved')); }
        
        db.ref('settings').once('value',s=>{
            if(s.exists()){
                if(s.val().notice) document.getElementById('notice-input').value = s.val().notice.text;
                if(s.val().rules) document.getElementById('rules-input').value = s.val().rules.text;
                if(s.val().paymentNumbers) {
                     document.getElementById('bkash-num').value = s.val().paymentNumbers.bkash;
                     document.getElementById('nagad-num').value = s.val().paymentNumbers.nagad;
                }
            }
        });
    </script>
</body>
</html>
