<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡ßã</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; margin: 0; padding-bottom: 80px; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background-color: #ffffff; min-height: 100vh; }
        .header { background: linear-gradient(135deg, #0088cc, #005f8f); color: white; padding: 20px; text-align: center; border-radius: 0 0 20px 20px; }
        .content-section { padding: 20px; display: none; }
        .active-section { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .balance-card { background: linear-gradient(135deg, #28a745, #218838); color: white; padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(40,167,69,0.3); }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; font-size: 1em; margin-bottom: 10px; }
        .btn-deposit { background: #0088cc; }
        .btn-withdraw { background: #dc3545; }
        .input-box { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        
        /* ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø */
        .history-item { background: #fff; border-bottom: 1px solid #eee; padding: 10px 5px; display: flex; justify-content: space-between; align-items: center; }
        .badge { padding: 3px 8px; border-radius: 5px; font-size: 0.8em; font-weight: bold; }
        .badge-pending { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .badge-approved { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .badge-rejected { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        .nav-bar { display: flex; justify-content: space-around; position: fixed; bottom: 0; left: 0; right: 0; max-width: 600px; margin: 0 auto; background: white; border-top: 1px solid #eee; padding: 10px 0; }
        .nav-btn { border: none; background: none; font-size: 0.9em; color: #666; }
        .nav-btn.active { color: #0088cc; font-weight: bold; }
        
        /* ‡¶Æ‡¶°‡¶æ‡¶≤ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 999; }
        .modal-content { background: white; padding: 20px; border-radius: 10px; width: 80%; max-width: 350px; text-align: center; }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

    <div class="container">
        <div class="header">
            <h3>‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡ßã</h3>
        </div>

        <main>
            <div id="offer-section" class="content-section active-section">
                <h3 style="text-align:center; color:#444;">üíé ‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</h3>
                <div style="background:#f9f9f9; padding:15px; border-radius:10px; border-left:5px solid #0088cc; margin-bottom:10px;"><b>‡ß≥710 ‡¶ü‡¶™‡¶Ü‡¶™</b> <span style="float:right; color:green;">‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡ß≥2,130</span></div>
                <div style="background:#f9f9f9; padding:15px; border-radius:10px; border-left:5px solid #0088cc; margin-bottom:10px;"><b>‡ß≥1,020 ‡¶ü‡¶™‡¶Ü‡¶™</b> <span style="float:right; color:green;">‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡ß≥3,370</span></div>
            </div>

            <div id="profile-section" class="content-section">
                <div class="balance-card">
                    <div>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</div>
                    <div style="font-size: 2.5em; font-weight: bold; margin: 5px 0;" id="user-balance">‡ß≥0.00</div>
                    <small>ID: <span id="uid-display">...</span></small>
                </div>

                <div style="display:flex; gap:10px; margin-bottom:20px;">
                    <button class="btn btn-deposit" onclick="showForm('deposit')">‚¨áÔ∏è ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</button>
                    <button class="btn btn-withdraw" onclick="showForm('withdraw')">‚¨ÜÔ∏è ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</button>
                </div>

                <div id="deposit-form" style="display:none; background:#f8f9fa; padding:15px; border-radius:10px; margin-bottom:20px;">
                    <h4 style="margin-top:0;">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</h4>
                    <select id="dep-method" class="input-box" onchange="showNum()">
                        <option value="">‡¶Æ‡ßá‡¶•‡¶° ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                        <option value="bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option>
                        <option value="nagad">‡¶®‡¶ó‡¶¶</option>
                    </select>
                    <div id="pay-info" style="display:none; color:#0088cc; margin-bottom:10px;">‡¶∏‡ßá‡¶®‡ßç‡¶° ‡¶Æ‡¶æ‡¶®‡¶ø ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞: <b id="admin-num">...</b></div>
                    <input type="number" id="dep-amount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="input-box">
                    <input type="text" id="dep-trx" placeholder="TrxID" class="input-box">
                    <button class="btn btn-deposit" onclick="submitDeposit()">‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
                </div>

                <div id="withdraw-form" style="display:none; background:#f8f9fa; padding:15px; border-radius:10px; margin-bottom:20px;">
                    <h4 style="margin-top:0;">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</h4>
                    <select id="wid-method" class="input-box">
                        <option value="bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option>
                        <option value="nagad">‡¶®‡¶ó‡¶¶</option>
                    </select>
                    <input type="number" id="wid-amount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="input-box">
                    <input type="text" id="wid-num" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" class="input-box">
                    <button class="btn btn-withdraw" onclick="submitWithdraw()">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>

                <h4>üìã ‡¶∞‡¶ø‡¶∏‡ßá‡¶®‡ßç‡¶ü ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® <button onclick="loadHistory()" style="float:right; font-size:0.7em; padding:5px;">üîÑ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂</button></h4>
                <div id="history-list">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
            </div>
        </main>

        <nav class="nav-bar">
            <button class="nav-btn active" onclick="showSection('offer-section', this)">üéÅ ‡¶Ö‡¶´‡¶æ‡¶∞</button>
            <button class="nav-btn" onclick="showSection('profile-section', this)">üë§ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</button>
        </nav>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyCF9cqEoQwPow2VbB0Koj1yyy4QMDofPQE",
          authDomain: "investmentwebsite1.firebaseapp.com",
          databaseURL: "https://investmentwebsite1-default-rtdb.firebaseio.com", 
          projectId: "investmentwebsite1",
          storageBucket: "investmentwebsite1.firebasestorage.app",
          messagingSenderId: "592540774650",
          appId: "1:592540774650:web:1ad31bf96cbc8c60db1943",
          measurementId: "G-QLTC23GYRE"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let USER_ID = 'user_' + Math.floor(Math.random()*100000);
        let USER_NAME = 'Guest';

        if(window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.ready();
            const u = window.Telegram.WebApp.initDataUnsafe.user;
            if(u) { USER_ID = u.id.toString(); USER_NAME = u.first_name; }
        }
        const localID = localStorage.getItem('my_app_uid');
        if(localID && !window.Telegram.WebApp.initDataUnsafe.user) USER_ID = localID;
        else localStorage.setItem('my_app_uid', USER_ID);

        document.getElementById('uid-display').innerText = USER_ID;

        // ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ì ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ
        db.ref('users/'+USER_ID).on('value', s => {
            if(s.exists()) document.getElementById('user-balance').innerText = '‡ß≥' + (s.val().balance || 0);
            else {
                db.ref('users/'+USER_ID).set({
                    name: USER_NAME, balance: 0, joined: new Date().toISOString()
                });
                fetch('https://ipapi.co/json/').then(r=>r.json()).then(d=>{
                    db.ref('users/'+USER_ID).update({ip:d.ip, location: d.city+', '+d.country_name});
                });
            }
        });

        // ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞
        let adminNums = {};
        db.ref('settings/paymentNumbers').on('value', s => adminNums = s.val() || {});
        function showNum() {
            const m = document.getElementById('dep-method').value;
            const info = document.getElementById('pay-info');
            if(m && adminNums[m]) {
                document.getElementById('admin-num').innerText = adminNums[m];
                info.style.display = 'block';
            } else info.style.display = 'none';
        }

        // ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü
        function submitDeposit() {
            const amt = parseFloat(document.getElementById('dep-amount').value);
            const trx = document.getElementById('dep-trx').value;
            const method = document.getElementById('dep-method').value;

            if(!amt || !trx || !method) return alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®!");

            const data = {
                userId: USER_ID, userName: USER_NAME, amount: amt, bonus: 0,
                method: method, trxId: trx, status: 'pending', timestamp: new Date().toISOString()
            };

            db.ref('deposits').push(data).then(() => {
                alert("‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶∏‡¶´‡¶≤! ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§");
                document.getElementById('deposit-form').style.display = 'none';
                // ‡¶´‡ßã‡¶∞‡ßç‡¶∏ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂
                loadHistory();
            });
        }

        // ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü
        function submitWithdraw() {
            const amt = parseFloat(document.getElementById('wid-amount').value);
            const num = document.getElementById('wid-num').value;
            const method = document.getElementById('wid-method').value;

            db.ref('users/'+USER_ID+'/balance').once('value', s => {
                if((s.val()||0) < amt) return alert("‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á!");
                
                db.ref('withdrawals').push({
                    userId: USER_ID, userName: USER_NAME, amount: amt,
                    method: method, number: num, status: 'pending', timestamp: new Date().toISOString()
                }).then(() => {
                    alert("‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶∏‡¶´‡¶≤!");
                    document.getElementById('withdraw-form').style.display = 'none';
                    loadHistory();
                });
            });
        }

        // ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶≤‡ßã‡¶° (‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶∏‡¶π)
        function loadHistory() {
            const listDiv = document.getElementById('history-list');
            listDiv.innerHTML = '<p style="text-align:center">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';
            
            let items = [];

            db.ref('deposits').orderByChild('userId').equalTo(USER_ID).limitToLast(10).once('value', ds => {
                ds.forEach(d => items.push({...d.val(), t: '‡¶ú‡¶Æ‡¶æ'}));
                
                db.ref('withdrawals').orderByChild('userId').equalTo(USER_ID).limitToLast(10).once('value', ws => {
                    ws.forEach(w => items.push({...w.val(), t: '‡¶§‡ßã‡¶≤‡¶æ'}));
                    
                    items.sort((a,b) => new Date(b.timestamp) - new Date(a.timestamp));
                    
                    if(items.length === 0) listDiv.innerHTML = '<p style="text-align:center; color:#888">‡¶ï‡ßã‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶á</p>';
                    else {
                        let html = '';
                        items.forEach(i => {
                            let cls = 'badge-pending';
                            let txt = '‚è≥ ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç';

                            if(i.status === 'approved') { cls = 'badge-approved'; txt = '‚úÖ ‡¶∏‡¶æ‡¶ï‡¶∏‡ßá‡¶∏'; }
                            else if(i.status === 'rejected') { cls = 'badge-rejected'; txt = '‚ùå ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤'; }

                            html += `<div class="history-item">
                                <div><b>${i.t}</b> <small>(${i.trxId || i.method})</small><br>‡ß≥${i.amount}</div>
                                <span class="badge ${cls}">${txt}</span>
                            </div>`;
                        });
                        listDiv.innerHTML = html;
                    }
                });
            });
        }
        
        loadHistory();
        // ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        setInterval(loadHistory, 3000); // ‡ß© ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶™‡¶∞ ‡¶Ö‡¶ü‡ßã ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶π‡¶¨‡ßá

        // UI Control
        function showForm(type) {
            document.getElementById('deposit-form').style.display = type==='deposit'?'block':'none';
            document.getElementById('withdraw-form').style.display = type==='withdraw'?'block':'none';
        }
        function showSection(id, btn) {
            document.querySelectorAll('.content-section').forEach(e=>e.classList.remove('active-section'));
            document.getElementById(id).classList.add('active-section');
            document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
        }
    </script>
</body>
</html>
