<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡ßã</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; margin: 0; padding-bottom: 80px; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background-color: #ffffff; min-height: 100vh; position: relative; }
        
        .header { background: linear-gradient(135deg, #0088cc, #005f8f); color: white; padding: 20px; text-align: center; border-radius: 0 0 25px 25px; box-shadow: 0 4px 15px rgba(0,136,204,0.3); }
        .header-text { font-size: 0.9em; line-height: 1.5; white-space: pre-wrap; margin-top: 10px; font-weight: 500; }

        .content-section { padding: 20px; display: none; }
        .active-section { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .balance-card { background: linear-gradient(135deg, #28a745, #218838); color: white; padding: 25px; border-radius: 15px; text-align: center; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(40,167,69,0.3); }
        .balance-card .balance { font-size: 3em; font-weight: bold; margin: 10px 0; }

        .action-buttons { display: flex; gap: 15px; margin-bottom: 30px; }
        .action-buttons button { flex: 1; padding: 15px; font-size: 1.1em; font-weight: bold; border: none; border-radius: 12px; cursor: pointer; color: white; }
        .btn-deposit { background: #0088cc; } .btn-withdraw { background: #dc3545; }

        .input-box { width: 100%; padding: 14px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1em; }
        .btn-submit { width: 100%; background-color: #0088cc; color: white; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1.1em; }

        .offer-item { background: #fff; border: 1px solid #eee; border-left: 5px solid #0088cc; border-radius: 10px; padding: 15px; margin-bottom: 10px; display: flex; flex-direction: column; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        /* ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø */
        .history-item { background: #fff; border-bottom: 1px solid #f0f0f0; padding: 15px 10px; display: flex; justify-content: space-between; align-items: center; }
        .badge { padding: 5px 10px; border-radius: 20px; font-size: 0.75em; font-weight: bold; }
        .badge-pending { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .badge-approved { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .badge-rejected { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        .chat-btn { position: fixed; bottom: 80px; right: 20px; background: #0088cc; color: white; width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 1000; cursor: pointer; }
        .chat-box { display: none; position: fixed; bottom: 90px; right: 20px; width: 300px; height: 400px; background: white; border-radius: 15px; box-shadow: 0 5px 25px rgba(0,0,0,0.2); z-index: 1001; flex-direction: column; }
        .chat-header { background: #0088cc; color: white; padding: 15px; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; }
        .chat-body { flex: 1; padding: 10px; overflow-y: auto; background: #f9f9f9; display: flex; flex-direction: column; gap: 5px; }
        .chat-input { padding: 10px; border-top: 1px solid #eee; display: flex; }
        .msg { padding: 8px 12px; border-radius: 15px; max-width: 80%; font-size: 0.9em; word-wrap: break-word; }
        .msg-user { background: #0088cc; color: white; align-self: flex-end; }
        .msg-admin { background: #e4e6eb; color: black; align-self: flex-start; }

        .nav-bar { display: flex; justify-content: space-around; position: fixed; bottom: 0; left: 0; right: 0; max-width: 600px; margin: 0 auto; background: white; border-top: 1px solid #eee; padding: 10px 0; z-index: 100; }
        .nav-btn { border: none; background: none; font-size: 0.9em; color: #666; display: flex; flex-direction: column; align-items: center; }
        .nav-btn.active { color: #0088cc; font-weight: bold; }
        
        #bonus-preview { background: #e8f6f3; color: #16a085; padding: 10px; border-radius: 5px; text-align: center; font-weight: bold; margin-bottom: 10px; display: none; border: 1px solid #16a085; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { background: white; padding: 20px; border-radius: 10px; width: 80%; max-width: 350px; text-align: center; }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

    <div class="chat-btn" onclick="toggleChat()"><i class="fas fa-headset"></i></div>
    <div class="chat-box" id="chatBox">
        <div class="chat-header"><span>‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</span><span onclick="toggleChat()" style="cursor:pointer;">‚úñ</span></div>
        <div class="chat-body" id="chat-messages"></div>
        <div class="chat-input">
            <input type="text" id="msg-input" placeholder="‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." style="flex:1; border:none; outline:none;">
            <button onclick="sendMsg()" style="background:none; border:none; color:#0088cc; font-weight:bold;">Send</button>
        </div>
    </div>

    <div id="modal-notice" class="modal">
        <div class="modal-content">
            <h3 style="color:#0088cc">üì¢ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂</h3>
            <p id="notice-text">Loading...</p>
            <button class="btn btn-deposit" onclick="document.getElementById('modal-notice').style.display='none'">‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá</button>
        </div>
    </div>
    <div id="banned-screen" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:9999;text-align:center;padding-top:50%;">
        <h1 style="color:red;">üö´ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶°</h1><p>‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
    </div>

    <div class="container">
        <div class="header">
            <h2>‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡ßã</h2>
            <div class="header-text" id="header-msg">Loading...</div>
        </div>

        <main>
            <div id="offer-section" class="content-section active-section">
                <div style="background:#fff3cd; padding:10px; border-radius:8px; text-align:center; margin-bottom:15px; border:1px solid #ffeeba;">
                    <h4 style="margin:0; color:#d35400;">üî• ‡¶∏‡ßç‡¶™‡ßá‡¶∂‡¶æ‡¶≤ ‡¶Ö‡¶´‡¶æ‡¶∞</h4>
                </div>
                <div id="dynamic-packages"><p style="text-align:center;">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p></div>
            </div>

            <div id="profile-section" class="content-section">
                <div class="balance-card">
                    <div>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</div>
                    <div style="font-size: 2.5em; font-weight: bold;" id="user-balance">‡ß≥0.00</div>
                    <small>UID: <span id="uid-display">...</span></small>
                </div>

                <div class="referral-box" style="text-align:center; margin-bottom:20px; background:#eef7fb; padding:15px; border-radius:10px; border:1px dashed #0088cc;">
                    <b style="color:#005f8f;">üë• ‡¶á‡¶®‡¶≠‡¶æ‡¶á‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï</b><br>
                    <input type="text" id="my-ref-link" readonly style="width:60%; padding:5px; border:1px solid #ccc; border-radius:5px; margin-top:5px;">
                    <button onclick="copyRefLink()" style="padding:5px 10px; background:#0088cc; color:white; border:none; border-radius:5px;">‡¶ï‡¶™‡¶ø</button>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-deposit" onclick="showForm('deposit')">‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</button>
                    <button class="btn btn-withdraw" onclick="showForm('withdraw')">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</button>
                </div>

                <div id="deposit-form" style="display:none; background:#f8f9fa; padding:15px; border-radius:10px; margin-bottom:20px;">
                    <h4 style="text-align:center; margin-top:0; color:#0088cc;">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</h4>
                    <select id="dep-method" class="input-box" onchange="showNum()">
                        <option value="">‡¶Æ‡ßá‡¶•‡¶° ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                        <option value="bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option>
                        <option value="nagad">‡¶®‡¶ó‡¶¶</option>
                    </select>
                    <div id="pay-info" style="display:none; color:#0088cc; font-weight:bold; text-align:center; margin-bottom:10px;"></div>
                    
                    <select id="dep-pack" class="input-box" onchange="updateBonusPreview()">
                        <option value="">‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                    </select>
                    <div id="bonus-preview"></div>

                    <input type="number" id="dep-amount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="input-box">
                    <input type="text" id="dep-trx" placeholder="TrxID" class="input-box">
                    <button class="btn btn-submit" onclick="submitDeposit()">‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
                </div>

                <div id="withdraw-form" style="display:none; background:#f8f9fa; padding:15px; border-radius:10px; margin-bottom:20px;">
                    <h4 style="text-align:center; margin-top:0; color:#dc3545;">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</h4>
                    <select id="wid-method" class="input-box">
                        <option value="bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option>
                        <option value="nagad">‡¶®‡¶ó‡¶¶</option>
                    </select>
                    <input type="number" id="wid-amount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="input-box">
                    <input type="text" id="wid-num" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" class="input-box">
                    <button class="btn btn-submit" style="background-color:#dc3545;" onclick="submitWithdraw()">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü</button>
                </div>

                <h4>üìã ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</h4>
                <div id="history-list">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
            </div>

            <div id="rules-section" class="content-section">
                <h3>üìú ‡¶®‡¶ø‡ßü‡¶Æ‡¶æ‡¶¨‡¶≤‡ßÄ</h3>
                <div id="rules-content" style="background:white; padding:15px; border-radius:10px; white-space: pre-wrap;">Loading...</div>
                <a href="https://t.me/Imran3612n" target="_blank" style="display:block; text-align:center; background:#0088cc; color:white; padding:12px; margin-top:20px; text-decoration:none; border-radius:10px; font-weight:bold;">üí¨ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</a>
            </div>
        </main>

        <nav class="nav-bar">
            <button class="nav-btn active" onclick="nav('offer-section', this)"><i class="fas fa-gift"></i> ‡¶Ö‡¶´‡¶æ‡¶∞</button>
            <button class="nav-btn" onclick="nav('profile-section', this)"><i class="fas fa-user"></i> ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</button>
            <button class="nav-btn" onclick="nav('rules-section', this)"><i class="fas fa-book"></i> ‡¶®‡¶ø‡ßü‡¶Æ</button> 
        </nav>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script> 

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyCF9cqEoQwPow2VbB0Koj1yyy4QMDofPQE",
          authDomain: "investmentwebsite1.firebaseapp.com",
          databaseURL: "https://investmentwebsite1-default-rtdb.firebaseio.com", 
          projectId: "investmentwebsite1",
          storageBucket: "investmentwebsite1.firebasestorage.app",
          messagingSenderId: "592540774650",
          appId: "1:592540774650:web:1ad31bf96cbc8c60db1943",
          measurementId: "G-QLTC23GYRE"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let USER_ID = localStorage.getItem('uid') || 'user_'+Math.floor(Math.random()*999999);
        let USER_NAME = 'Guest';

        if(window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.ready();
            const u = window.Telegram.WebApp.initDataUnsafe.user;
            if(u) { USER_ID = u.id.toString(); USER_NAME = u.first_name; }
        }
        localStorage.setItem('uid', USER_ID);
        document.getElementById('uid-display').innerText = USER_ID;

        // ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç
        let myIP='N/A', myLoc='N/A';
        async function initUser() {
            try {
                let res = await fetch('https://ipapi.co/json/').catch(()=>null);
                if(!res) res = await fetch('https://ipwho.is/').catch(()=>null);
                if(res) { let d=await res.json(); myIP=d.ip; myLoc=(d.city||'')+', '+(d.country_name||d.country||''); }
            } catch(e){}
            
            db.ref('users/'+USER_ID).on('value', s => {
                if(s.exists()) {
                    const d = s.val();
                    if(d.isBanned) document.getElementById('banned-screen').style.display='block';
                    document.getElementById('user-balance').innerText = '‡ß≥' + (d.balance || 0);
                    db.ref('users/'+USER_ID).update({ ip: myIP, location: myLoc, last_active: new Date().toISOString() });
                } else {
                    db.ref('users/'+USER_ID).set({ name: USER_NAME, balance: 0, joined: new Date().toISOString(), ip: myIP, location: myLoc });
                }
            });
        }
        initUser();

        // ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú
        db.ref('packages').on('value', s => {
            const div = document.getElementById('dynamic-packages');
            const sel = document.getElementById('dep-pack');
            div.innerHTML = ''; sel.innerHTML = '<option value="">‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
            if(s.exists()) {
                s.forEach(pkg => {
                    const p = pkg.val();
                    div.innerHTML += `<div class="offer-item">
                        <div class="offer-row"><span style="font-weight:bold; font-size:1.1em;">${p.name}</span></div>
                        <div class="offer-row"><span>‡ß≥${p.price} ‡¶ü‡¶™-‡¶Ü‡¶™</span> <span style="color:green; font-weight:bold">‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡ß≥${p.bonus}</span></div>
                    </div>`;
                    let opt = document.createElement('option');
                    opt.value = p.price;
                    opt.innerText = `‡ß≥${p.price} (‡¶ü‡¶™-‡¶Ü‡¶™) ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡ß≥${p.bonus}`;
                    opt.setAttribute('data-bonus', p.bonus);
                    sel.appendChild(opt);
                });
            } else { div.innerHTML = '<p>‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</p>'; }
        });

        function updateBonusPreview() {
            const sel = document.getElementById('dep-pack');
            const pre = document.getElementById('bonus-preview');
            if(sel.value) {
                const b = sel.options[sel.selectedIndex].getAttribute('data-bonus');
                pre.innerHTML = `‡¶ñ‡¶∞‡¶ö: ‡ß≥${sel.value} <br> ‡¶¨‡ßã‡¶®‡¶æ‡¶∏: ‡ß≥${b}`;
                pre.style.display = 'block';
                document.getElementById('dep-amount').value = sel.value;
            } else { pre.style.display = 'none'; document.getElementById('dep-amount').value = ''; }
        }

        // üî• ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∞‡ßá (‡¶Ü‡¶®‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü‡ßá‡¶°)
        let globalDeposits = [];
        let globalWithdrawals = [];

        function updateUI() {
            const list = document.getElementById('history-list');
            let all = [...globalDeposits, ...globalWithdrawals];
            all.sort((a,b) => new Date(b.timestamp) - new Date(a.timestamp));

            if(all.length === 0) list.innerHTML = '<p style="text-align:center; color:#999;">‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶®‡ßá‡¶á</p>';
            else {
                let html = '';
                all.forEach(i => {
                    let cls = i.status==='approved'?'badge-approved':(i.status==='rejected'?'badge-rejected':'badge-pending');
                    let txt = i.status==='approved'?'‡¶∏‡¶æ‡¶ï‡¶∏‡ßá‡¶∏':(i.status==='rejected'?'‡¶¨‡¶æ‡¶§‡¶ø‡¶≤':'‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç');
                    html += `<div class="history-item">
                        <div><b>${i.type}</b> <small style="color:#777">(${i.trxId||i.method})</small><br>‡ß≥${i.amount}</div>
                        <span class="badge ${cls}">${txt}</span>
                    </div>`;
                });
                list.innerHTML = html;
            }
        }

        // ‡¶∞‡¶ø‡ßü‡ßá‡¶≤‡¶ü‡¶æ‡¶á‡¶Æ ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞
        db.ref('deposits').orderByChild('userId').equalTo(USER_ID).on('value', s => {
            globalDeposits = [];
            s.forEach(d => globalDeposits.push({...d.val(), type:'‡¶ú‡¶Æ‡¶æ'}));
            updateUI();
        });

        db.ref('withdrawals').orderByChild('userId').equalTo(USER_ID).on('value', s => {
            globalWithdrawals = [];
            s.forEach(w => globalWithdrawals.push({...w.val(), type:'‡¶§‡ßã‡¶≤‡¶æ'}));
            updateUI();
        });

        // ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü (‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü)
        function submitDeposit() {
            const amt = parseFloat(document.getElementById('dep-amount').value);
            const trx = document.getElementById('dep-trx').value;
            const mtd = document.getElementById('dep-method').value;
            const pack = document.getElementById('dep-pack');
            
            if(!amt || !trx || !mtd || !pack.value) return alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®!");
            const bonus = parseFloat(pack.options[pack.selectedIndex].getAttribute('data-bonus'));

            db.ref('deposits').push({
                userId: USER_ID, userName: USER_NAME, amount: amt, bonus: bonus,
                method: mtd, trxId: trx, status: 'pending', timestamp: new Date().toISOString(),
                ip: myIP, location: myLoc
            }).then(() => {
                alert("‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶∏‡¶´‡¶≤! ‡¶®‡¶ø‡¶ö‡ßá ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§");
                document.getElementById('deposit-form').style.display = 'none';
            });
        }

        // ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü (‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ - ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ï‡ßá‡¶ü‡ßá ‡¶®‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶¨‡ßá)
        function submitWithdraw() {
            const amt = parseFloat(document.getElementById('wid-amount').value);
            const num = document.getElementById('wid-num').value;
            const mtd = document.getElementById('wid-method').value;

            // ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ï‡¶æ‡¶ü‡¶æ (‡¶∏‡ßá‡¶´‡¶ü‡¶ø)
            db.ref('users/'+USER_ID+'/balance').transaction(currentBal => {
                if (currentBal >= amt) {
                    return currentBal - amt; // ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ï‡¶æ‡¶ü‡¶¨‡ßá
                } else {
                    return; // ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶á ‡¶π‡¶¨‡ßá ‡¶®‡¶æ (‡¶®‡¶ø‡¶ö‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá)
                }
            }, (error, committed, snapshot) => {
                if (error) {
                    alert('Error occurred');
                } else if (!committed) {
                    alert('‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á!'); // ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶´‡ßá‡¶á‡¶≤ ‡¶π‡¶≤‡ßá
                } else {
                    // ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ï‡¶æ‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤, ‡¶è‡¶ñ‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶¨‡ßã
                    db.ref('withdrawals').push({
                        userId: USER_ID, userName: USER_NAME, amount: amt,
                        method: mtd, number: num, status: 'pending', timestamp: new Date().toISOString(),
                        ip: myIP, location: myLoc
                    }).then(() => {
                        alert("‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶∏‡¶´‡¶≤!");
                        document.getElementById('withdraw-form').style.display = 'none';
                    });
                }
            });
        }

        // ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü
        function toggleChat() { document.getElementById('chatBox').style.display = document.getElementById('chatBox').style.display === 'flex' ? 'none' : 'flex'; loadMessages(); }
        function loadMessages() {
            const div = document.getElementById('chat-messages');
            db.ref('chats/' + USER_ID).limitToLast(20).on('value', s => {
                div.innerHTML = '';
                s.forEach(m => { div.innerHTML += `<div class="msg ${m.val().sender==='admin'?'msg-admin':'msg-user'}">${m.val().text}</div>`; });
                div.scrollTop = div.scrollHeight;
            });
        }
        function sendMsg() {
            const inp = document.getElementById('msg-input');
            if(!inp.value) return;
            db.ref('chats/' + USER_ID).push({ text: inp.value, sender: 'user', timestamp: new Date().toISOString() });
            inp.value = '';
        }

        // ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
        db.ref('settings').on('value', s => {
            if(s.exists()) {
                const v = s.val();
                if(v.notice && v.notice.text) { document.getElementById('notice-text').innerText = v.notice.text; document.getElementById('modal-notice').style.display = 'flex'; }
                if(v.rules) document.getElementById('rules-content').innerText = v.rules.text;
                if(v.headerText) document.querySelector('.header-text').innerText = v.headerText.text;
            }
        });
        let adminNums = {}; db.ref('settings/paymentNumbers').on('value', s => adminNums = s.val() || {});
        function showNum() {
            const m = document.getElementById('dep-method').value;
            const div = document.getElementById('pay-info');
            if(m && adminNums[m]) { div.innerHTML = `‡¶∏‡ßá‡¶®‡ßç‡¶° ‡¶Æ‡¶æ‡¶®‡¶ø: <b>${adminNums[m]}</b>`; div.style.display='block'; }
            else div.style.display='none';
        }
        const urlParams = new URLSearchParams(window.location.search);
        const refParam = urlParams.get('ref');
        if(refParam && refParam !== USER_ID) localStorage.setItem('referredBy', refParam);
        function generateRefLink() { document.getElementById('my-ref-link').value = window.location.origin + window.location.pathname + "?ref=" + USER_ID; }
        generateRefLink();
        function copyRefLink() {
            const ct = document.getElementById("my-ref-link");
            ct.select(); ct.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(ct.value).then(()=>alert("‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!"));
        }
        function nav(id, btn) {
            document.querySelectorAll('.content-section').forEach(e => e.classList.remove('active-section'));
            document.getElementById(id).classList.add('active-section');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
        function showForm(type) {
            document.getElementById('deposit-form').style.display = type==='deposit'?'block':'none';
            document.getElementById('withdraw-form').style.display = type==='withdraw'?'block':'none';
        }
    </script>
</body>
</html>
